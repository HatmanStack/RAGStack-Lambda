<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RagStackChat Web Component Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    .test-container {
      border: 1px solid #ddd;
      padding: 20px;
      margin: 20px 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #007bff;
      padding-bottom: 10px;
    }
    h2 {
      margin-top: 0;
      color: #555;
      font-size: 1.2em;
    }
    .test-info {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    .test-info code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <h1>RagStackChat Web Component Tests</h1>

  <div class="test-info">
    <strong>Test Status:</strong> Web component bundle loaded from CDN<br>
    <strong>Bundle:</strong> <code>ragstack-chat.js</code><br>
    <strong>Config:</strong> Fetched from CDN config.json, theme from GraphQL API<br>
    <strong>Open DevTools Console:</strong> Check for component registration and errors
  </div>

  <div class="test-container">
    <h2>Test 1: Theme from Settings UI (API fetch)</h2>
    <p><em>No theme attributes - fetches theme from GraphQL API based on Settings UI config</em></p>
    <ragstack-chat
      conversation-id="test-api-theme"
      header-text="API Theme Chat"
      header-subtitle="Theme loaded from Settings UI"
    ></ragstack-chat>
  </div>

  <div class="test-container">
    <h2>Test 2: Dark Theme (attribute override)</h2>
    <p><em>theme-preset="dark" overrides API theme</em></p>
    <ragstack-chat
      conversation-id="test-dark"
      header-text="Dark Theme Chat"
      header-subtitle="Testing dark theme preset"
      theme-preset="dark"
    ></ragstack-chat>
  </div>

  <div class="test-container">
    <h2>Test 3: Custom Theme with Color Override</h2>
    <p><em>theme-overrides attribute overrides API theme</em></p>
    <ragstack-chat
      conversation-id="test-custom"
      header-text="Custom Purple Chat"
      header-subtitle="Testing theme overrides"
      theme-overrides='{"primaryColor": "#9c27b0"}'
    ></ragstack-chat>
  </div>

  <div class="test-container">
    <h2>Test 4: Custom Input Placeholder</h2>
    <ragstack-chat
      conversation-id="test-placeholder"
      header-text="Custom Placeholder"
      header-subtitle="Testing input-placeholder attribute"
      input-placeholder="Type your custom question here..."
    ></ragstack-chat>
  </div>

  <!-- Load the web component bundle from CDN -->
  <script src="https://d2fk0t9sdkg4j7.cloudfront.net/ragstack-chat.js"></script>

  <!-- Test script -->
  <script>
    console.log('=== RagStackChat Web Component Test Page ===');

    // Check if custom element is registered
    const isRegistered = customElements.get('ragstack-chat');
    console.log('Custom element registered:', !!isRegistered);

    if (!isRegistered) {
      console.error('‚ùå ragstack-chat custom element not registered!');
      document.body.insertAdjacentHTML('afterbegin',
        '<div style="background: #fee; border: 2px solid #c00; padding: 20px; margin: 20px 0;">' +
        '<h3>‚ö†Ô∏è Error: Web component not loaded</h3>' +
        '<p>The ragstack-chat custom element is not registered. Check console for errors.</p>' +
        '</div>'
      );
    } else {
      console.log('‚úÖ ragstack-chat custom element registered successfully');
    }

    // Wait for components to mount
    setTimeout(() => {
      const chatElements = document.querySelectorAll('ragstack-chat');
      console.log(`Found ${chatElements.length} chat instances on page`);

      chatElements.forEach((chat, index) => {
        console.log(`Chat ${index + 1}:`, {
          conversationId: chat.getAttribute('conversation-id'),
          headerText: chat.getAttribute('header-text'),
          themePreset: chat.getAttribute('theme-preset') || '(from API)'
        });
      });

      // Test programmatic API
      const firstChat = chatElements[0];
      if (firstChat && firstChat.getConversationId) {
        console.log('Testing programmatic API...');
        console.log('Current conversation ID:', firstChat.getConversationId());
      }
    }, 1000);

    // Listen for custom events
    document.addEventListener('ragstack-chat:send-message', (event) => {
      console.log('üöÄ Message sent:', event.detail);
    });

    document.addEventListener('ragstack-chat:response-received', (event) => {
      console.log('üì® Response received:', event.detail);
    });

    console.log('Test page loaded. Try:');
    console.log('1. Test 1 should use theme from Settings UI');
    console.log('2. Test 2-3 use attribute overrides');
    console.log('3. Check DevTools Network tab for config.json and getThemeConfig calls');
  </script>
</body>
</html>
